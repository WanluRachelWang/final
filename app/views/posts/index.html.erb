<style>
  .media-pic{
    height: 100px;
  }

  .post-pic{
    height: 64px;
  }

  .post-heading{
    color: darkgray;
  }

  .reply-pic{
    height: 30px;
  }

  .restaurant-name{
    text-align: left;
    font-weight: bold;
  }

  .img-thumbnail{
    width: 100%;
  }

  .restaurant-img{
    border: 4px solid lightgrey;
    border-radius: 4px;
  }

  .restaurant-address{
    font-size: 11px;
  }

  .restaurant-snippet{
    font-size: 12px;
    color: gray;
  }

</style>

<div class="container">

  <% if notice.present? %>
    <div class="row">
      <div class="alert alert-danger" role="alert">
        <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
        <span class="sr-only">Error:</span>
        <%= notice %>
      </div>
    </div>
  <% end %>

  <!-- If user logged in show inputbox-->
  <% if session["user_id"].present? %>
    <%= form_tag "/posts", :class => "form-horizontal" do %>
      <div class="row">
        <div class="col-xs-12">
          <div class="panel panel-default">
            <div class="panel-body">

              <div class="form-group row">
                <div class="media col-md-12">
                  <div class="media-left media-middle">
                    <a href="#">
                      <%= image_tag "default-user-image.png", :class => "media-object media-pic img-rounded" %>
                    </a>
                  </div>
                  <div class="media-body">
                    <%= label_tag 'post_text', "Share your comment about a restaurant", :class => "media-heading"%>
                    <%= text_area_tag 'post_text', nil, :rows => 3, :class => "form-control", :placeholder => "Your content goes here" %>
                  </div>
                </div>
              </div>

              <div class="form-group row">
                <div class="col-md-2">
                  <label for="restaurant_id">Choose a restaurant: </label>
                </div>
                <div class="col-md-4">
                  <select name="restaurant_id" class="form-control input-sm">
                    <% @restaurants.each do |restaurant| %>
                      <option value="<%= restaurant.id %>">
                        <%= restaurant.name %>
                      </option>
                    <% end %>
                  </select>
                </div>
                <div class="col-md-1">
                  <label for="rating">Rating: </label>
                </div>
                <div class="col-md-4">
                  <select name="rating" class="form-control input-sm">
                    <option value=5>5</option>
                    <option value=4>4</option>
                    <option value=3>3</option>
                    <option value=2>2</option>
                    <option value=1>1</option>
                  </select>
                </div>
                <div class="col-md-1">
                  <button class="btn btn-primary form-control" type="submit">Share</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>

  <div class="row">

    <!-- Posts and replies-->
    <div class="col-md-8">
      <% if @posts %>
        <% @posts.each do |post| %>
          <% restaurant = post.restaurant %>
          <div class="panel panel-default">
            <div class="panel-body">
              <div class="media">
                <div class="media-left">
                  <a href="#">
                    <%= image_tag "default-user-image.png", :class => "media-object post-pic img-rounded" %>
                  </a>
                </div>
                <div class="media-body">
                  <h6 class="media-heading post-heading">
                    <%= @user.nick_name %> sent a post on:<%= post.post_time %>
                    <% if @user && @user.id == post.user_id  %>
                      (<%= link_to "Delete", "/posts/#{post.id}", :method => 'delete' %>)
                    <% end %>
                  </h6>
                  <h5 class="">
                    <!-- restaurant name-->
                    <a href="#"><%= restaurant.name %></a>

                    <!-- rating-->
                    <% post.rating.times do %>
                      &#9733;
                    <% end %>

                    <% (5 - post.rating).times do %>
                      &#9734;
                    <% end %>

                  </h5>
                  <%= post.post_text %>
                </div>
              </div>
            </div>

            <div class="panel-footer">
              <a href="#">Like</a>
              <%  %>
              
              <a data-toggle="collapse" href="#collapse-<%= post.id %>" aria-expanded="false" aria-controls="#collapse-<%= post.id %>">
                Comments(<%= post.replies.count%>)
              </a>

              <!-- reply list-->
              <ul class="media-list collapse" id = "collapse-<%= post.id %>">

                <% post.replies.each do |reply| %>
                  <li class="media">
                    <div class="media-left">
                      <a href="#">
                        <%= image_tag "default-user-image.png", :class => "media-object reply-pic img-rounded" %>
                      </a>
                    </div>
                    <div class="media-body">
                      <%= link_to "@#{reply.user.nick_name}:", "#" %><%= reply.content %>
                      <h6 class="media-heading post-heading">
                        Replied on: <%= reply.time %>

                        <% if @user && @user.id == reply.user_id  %>
                          (<%= link_to "Delete", "/replies/#{reply.id}", :method => 'delete' %>)
                        <% end %>

                      </h6>
                    </div>
                  </li>
                <% end %>
              </ul>

              <% if @user %>
                <%= form_tag "/replies" do %>
                  <div class="row">
                    <div class="form-group col-sm-9">
                      <%= text_area_tag 'content', nil, :rows => 1, :class => "form-control", :placeholder => "Say something about this post" %>
                    </div>
                    <div class="form-group col-sm-2">
                      <button class="btn btn-primary" type="submit">Send</button>
                    </div>
                  </div>
                  <%= text_field_tag "post_id", post.id, :type => "hidden" %>
                <% end %>
              <% end %>
            </div>
            
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- restaurants-->
    <div class="col-md-4">

      <% @restaurants.shuffle.first(20).each do |restaurant| %>

        <div class="media well">
          <div class="media-left">
            <a href="#">
              <%= image_tag restaurant.image_url, :class => "media-object restaurant-img" %>
            </a>
          </div>
          <div class="media-body">
            <h4 class="media-heading"><%= restaurant.name %></h4>
            <%= image_tag restaurant.rating_img_url %>

            <% if restaurant.snippet_text.present? %>
              <div class="restaurant-snippet">
                <%= restaurant.snippet_text %>
              </div>
            <% end %>

            <div class="restaurant-address">
              <em><%= restaurant.location_display_address %></em>
            </div>
          </div>
        </div>

      <% end %>

    </div>
  </div>
</div>